name: Uptime Check

on:
    schedule:
        - cron: '*/10 * * * *'
    workflow_dispatch:
        inputs:
            site_url:
                description: "Override site URL to check (defaults to repo variable SITE_URL or lumiere-landing.vercel.app)"
                required: false
                default: ""

jobs:
    ping:
        runs-on: ubuntu-latest
        env:
            INPUT_SITE_URL: ${{ github.event.inputs.site_url }}
            VAR_SITE_URL: ${{ vars.SITE_URL }}
            DEFAULT_SITE_URL: https://lumiere-landing.vercel.app
        steps:
            - name: Check health endpoint
                shell: bash
                run: |
                    set -e
                    TARGET_URL="${INPUT_SITE_URL:-${VAR_SITE_URL:-${DEFAULT_SITE_URL}}}"
                    curl -sfS "${TARGET_URL}/api/health" -o /dev/null
                    echo "Healthcheck OK for ${TARGET_URL}"
